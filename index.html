
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>b2accessdeprovisioning &#8212; b2accessdeprovisioning 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="b2accessdeprovisioning.configparser module" href="configparser.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="b2accessdeprovisioning">
<h1>b2accessdeprovisioning<a class="headerlink" href="#b2accessdeprovisioning" title="Permalink to this headline">¬∂</a></h1>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/b2accessdeprovisioning"><img alt="https://img.shields.io/pypi/v/b2accessdeprovisioning.svg" src="https://img.shields.io/pypi/v/b2accessdeprovisioning.svg" /></a>
<p>A Python tool for handling the (de)provisioning of B2ACCESS user accounts.</p>
<p>The b2accessdeprovisioning tool can be used to retrieve the list of permanently disabled B2ACCESS user accounts via Unity‚Äôs Administration API. For each of the disabled accounts, the tool performs the following operations:</p>
<ol class="arabic simple">
<li>immediate removal of assigned attributes (excluding user identifiers)</li>
<li>scheduled removal of all account information after a given period of time</li>
</ol>
<p>Finally, the tool sends a notification to one or more recipients containing the list of deprovisioned accounts.</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¬∂</a></h2>
<ul class="simple">
<li>B2ACCESS integration via Unity‚Äôs Administration API v1</li>
<li>Attribute whitelisting to indicate information that should be saved when removing account data; otherwise the tool removes all attributes assigned to permanently disabled B2ACCESS user accounts</li>
<li>Adjustable duration of time for which the records of deprovisioned users should be maintained</li>
<li>Email notifications via SMTP containing deprovisioned account information in json format</li>
</ul>
</div>
<div class="section" id="python-version">
<h2>Python version<a class="headerlink" href="#python-version" title="Permalink to this headline">¬∂</a></h2>
<p>Python 2.6 or 2.7 are fully supported.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¬∂</a></h2>
<p>To install the tool, simply run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ pip install b2accessdeprovisioning
üç∫
</pre></div>
</div>
</div>
<div class="section" id="third-party-libraries-and-dependencies">
<h2>Third party libraries and dependencies<a class="headerlink" href="#third-party-libraries-and-dependencies" title="Permalink to this headline">¬∂</a></h2>
<p>The following libraries will be installed when you install the client library:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/yaml/pyyaml">PyYAML</a></li>
<li><a class="reference external" href="https://github.com/EUDAT-B2ACCESS/unity-api-python-client">unityapiclient</a></li>
<li><a class="reference external" href="https://github.com/newvem/pytz">pytz</a></li>
<li><a class="reference external" href="https://github.com/kennethreitz/requests">requests</a></li>
</ul>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¬∂</a></h2>
<p>Tool settings are adjustable via the <code class="docutils literal"><span class="pre">config.yml</span></code> configuration file.</p>
<div class="section" id="example-config-yml">
<h3>Example <code class="docutils literal"><span class="pre">config.yml</span></code><a class="headerlink" href="#example-config-yml" title="Permalink to this headline">¬∂</a></h3>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># B2ACCESS API endpoint connection details</span>
<span class="l l-Scalar l-Scalar-Plain">api</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">base_url</span><span class="p p-Indicator">:</span> <span class="s">&quot;https://b2access.eudat.eu:8443&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="s">&quot;rest-admin&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="s">&quot;v1&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span> <span class="s">&quot;unity_user&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&quot;unity_password&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">cert_verify</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="c1"># List of attributes that should be saved when removing user information.</span>
<span class="c1"># Attributes not listed here will be immediately removed upon user</span>
<span class="c1"># deprovisioning.</span>
<span class="l l-Scalar l-Scalar-Plain">attr_whitelist</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[]</span>

<span class="c1"># Duration of time for which the records of deprovisioned users should be</span>
<span class="c1"># maintained (in days). After that period all information about the</span>
<span class="c1"># deprovisioned users will be permanently removed.</span>
<span class="l l-Scalar l-Scalar-Plain">retention_period</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">365</span>

<span class="c1"># Notification settings</span>
<span class="l l-Scalar l-Scalar-Plain">notifications</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">email</span><span class="p p-Indicator">:</span>
    <span class="c1"># SMTP host to connect to. Defaults to the local host if empty.</span>
    <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="s">&quot;smtp.example.eu&quot;</span>
    <span class="c1"># SMTP port to connect to. Defaults to the standard SMTP port (25) if empty.</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">587</span>
    <span class="c1"># Whether to put the SMTP connection in TLS. Defaults to False.</span>
    <span class="l l-Scalar l-Scalar-Plain">use_tls</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="c1"># Login username/password if the SMTP server requires authentication;</span>
    <span class="c1"># otherwise empty.</span>
    <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span> <span class="s">&quot;smtp_user&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&quot;smtp_password&quot;</span>
    <span class="c1"># Sender address</span>
    <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span> <span class="s">&quot;B2ACCESS</span><span class="nv"> </span><span class="s">Notifications</span><span class="nv"> </span><span class="s">&lt;noreply@b2access.eudat.eu&gt;&quot;</span>
    <span class="c1"># List of recipient addresses</span>
    <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;SP1</span><span class="nv"> </span><span class="s">Operator</span><span class="nv"> </span><span class="s">&lt;admin@sp1.eudat.eu&gt;&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;SP2</span><span class="nv"> </span><span class="s">Operator</span><span class="nv"> </span><span class="s">&lt;admin@sp2.eudat.eu&gt;&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;SP3</span><span class="nv"> </span><span class="s">Operator</span><span class="nv"> </span><span class="s">&lt;admin@sp3.eudat.eu&gt;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">subject</span><span class="p p-Indicator">:</span> <span class="s">&quot;Deprovisioned</span><span class="nv"> </span><span class="s">B2ACCESS</span><span class="nv"> </span><span class="s">accounts&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">intro_text</span><span class="p p-Indicator">:</span> <span class="s">&quot;See</span><span class="nv"> </span><span class="s">attachment</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">details</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">deprovisioned</span><span class="nv"> </span><span class="s">B2ACCESS</span><span class="nv"> </span><span class="s">accounts.\n\nNote:</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">automated</span><span class="nv"> </span><span class="s">email,</span><span class="nv"> </span><span class="s">please</span><span class="nv"> </span><span class="s">don&#39;t</span><span class="nv"> </span><span class="s">reply.&quot;</span>

<span class="c1"># (Optional) The group of users to check for disabled user accounts.</span>
<span class="c1"># Defaults to the ROOT group</span>
<span class="c1">#user_group: &quot;testGroup&quot;</span>

<span class="c1"># Logging level: CRITICAL, ERROR, WARNING, INFO, or DEBUG. Defaults to WARNING.</span>
<span class="l l-Scalar l-Scalar-Plain">log_level</span><span class="p p-Indicator">:</span> <span class="s">&quot;WARNING&quot;</span>

<span class="c1"># Determines if changes will be made if needed</span>
<span class="l l-Scalar l-Scalar-Plain">dry_run</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>See also <code class="docutils literal"><span class="pre">config.yml.example</span></code>.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¬∂</a></h2>
<p>Simply run the <code class="docutils literal"><span class="pre">b2accessdeprovisioning.monitor</span></code> module:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python -m b2accessdeprovisioning.monitor
</pre></div>
</div>
<p>Note: The tool will look for the <code class="docutils literal"><span class="pre">config.yml</span></code> configuration file in the current directory.</p>
<div class="section" id="example-notification">
<h3>Example notification<a class="headerlink" href="#example-notification" title="Permalink to this headline">¬∂</a></h3>
<p>Information about the deprovisioned user accounts is sent via an email attachment in json format (<code class="docutils literal"><span class="pre">users.json</span></code>):</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;email1@example.com&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;3f3d5b40-26ce-45db-808a-a5ca3a4e7515&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;email2@example.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email3@example.com&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;663a5b04-62ec-9d3b-078b-546734ae5733&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;983d5b41-abdg-45dc-808b-64633a4e7516&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-on-background">
<h2>Run on background<a class="headerlink" href="#run-on-background" title="Permalink to this headline">¬∂</a></h2>
<p>In order to run the script on background, you need to create a job schedule. This cron command runs the script every 24th hour.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="m">0</span> */24 * * * <span class="nb">cd</span> &lt;path-to-repo&gt; <span class="o">&amp;&amp;</span> python -m b2accessdeprovisioning.monitor
</pre></div>
</div>
</div>
</div>
<div class="section" id="reference">
<h1>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¬∂</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="configparser.html">b2accessdeprovisioning.configparser module</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitor.html">b2accessdeprovisioning.monitor module</a></li>
<li class="toctree-l1"><a class="reference internal" href="notifier.html">b2accessdeprovisioning.notifier module</a></li>
<li class="toctree-l1"><a class="reference internal" href="user.html">b2accessdeprovisioning.user module</a></li>
</ul>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¬∂</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">b2accessdeprovisioning</a><ul>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#python-version">Python version</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#third-party-libraries-and-dependencies">Third party libraries and dependencies</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#example-config-yml">Example <code class="docutils literal"><span class="pre">config.yml</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#example-notification">Example notification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#run-on-background">Run on background</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference">Reference</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="configparser.html" title="next chapter">b2accessdeprovisioning.configparser module</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, GRNET S.A..
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/EUDAT-B2ACCESS/b2access-deprovisioning" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>